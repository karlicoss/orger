[tox]
minversion = 3.5
# relies on the correct version of Python installed
envlist = py3,mypy

[testenv]
passenv =
    CI CI_*
commands =
    pip install .[testing]
    # posargs allow test filtering, e.g. tox ... -- -k test_name
    # -rap to print tests summary even when they are successful
    python -m pytest -rap src {posargs}


[testenv:mypy]
skip_install = true
commands =
    pip install .[linting]
    python -m mypy src/orger/inorganic.py \
                   # ugh. only check core without modules..
                   src/orger/common.py    \
                   src/orger/org_view.py  \
                   # txt report is a bit more convenient to view on CI
                   --txt-report  .mypy-coverage      \
                   --html-report .mypy-coverage      \
                   {posargs}

    # TODO fix the modules
    # ideally need HPI assistance to install the necessary dependencies
    # extract via AST or something
    pip install HPI
    python -m mypy              \
       -p modules.github        \
       -p modules.hyp2org       \
       -p modules.hypothesis    \
       # -p modules.instapaper    \
       # -p modules.ip2org        \
       -p modules.kobo2org      \
       # -p modules.kobo          \
       -p modules.krill         \
       -p modules.materialistic \
       -p modules.movies        \
       -p modules.pdfs          \
       -p modules.pinboard      \
       -p modules.pocket_demo   \
       # -p modules.pocket        \
       -p modules.polar         \
       # -p modules.reddit_all    \
       # -p modules.reddit        \
       -p modules.roamresearch  \
       -p modules.rss           \
       -p modules.rtm2org       \
       # -p modules.stackexchange \
       -p modules.twitter_likes \
       -p modules.twitter       \
       -p modules.vkfavs        \
       -p modules.youtube
